<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Главная панель - Бухгалтер</title>
</head>
<body th:replace="~{layout :: html(
    title='Главная панель бухгалтера',
    icon='bi-speedometer2',
    actions=~{:: #actions},
    content=~{:: #content},
    scripts=~{:: #scripts}
)}">

<div id="actions">
    <div class="btn-group">
        <select class="form-select form-select-sm" id="periodSelect" onchange="changePeriod()">
            <option th:each="m : ${#numbers.sequence(1,12)}"
                    th:value="${m + ',' + year}"
                    th:selected="${month == m}"
                    th:text="${#temporals.format(#temporals.create(year, m, 1), 'MMMM yyyy')}">
            </option>
        </select>
    </div>
</div>

<div id="content">
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" th:action="@{/accountant/dashboard}" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label for="month" class="form-label">Месяц</label>
                    <select class="form-select" id="month" name="month">
                        <option th:each="m : ${#numbers.sequence(1,12)}"
                                th:value="${m}"
                                th:selected="${month == m}"
                                th:text="${#temporals.format(#temporals.create(year, m, 1), 'MMMM')}">
                        </option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="year" class="form-label">Год</label>
                    <select class="form-select" id="year" name="year">
                        <option th:each="y : ${#numbers.sequence(2020, 2030)}"
                                th:value="${y}"
                                th:selected="${year == y}"
                                th:text="${y}">
                        </option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-dark w-100">
                        <i class="bi bi-filter"></i> Применить
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card stat-card text-white bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Всего начислено</h6>
                            <h3 th:text="${totalAccruals + ' руб.'}">0 руб.</h3>
                        </div>
                        <i class="bi bi-cash-coin fs-1 opacity-50"></i>
                    </div>
                    <p class="card-text mb-0">Фонд оплаты труда</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card text-white bg-danger">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Всего удержано</h6>
                            <h3 th:text="${totalDeductions + ' руб.'}">0 руб.</h3>
                        </div>
                        <i class="bi bi-arrow-down-circle fs-1 opacity-50"></i>
                    </div>
                    <p class="card-text mb-0">Налоги и удержания</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card text-white bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">К выплате</h6>
                            <h3 th:text="${netTotal + ' руб.'}">0 руб.</h3>
                        </div>
                        <i class="bi bi-wallet2 fs-1 opacity-50"></i>
                    </div>
                    <p class="card-text mb-0">Чистая сумма</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card text-white bg-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Сотрудников</h6>
                            <h3 th:text="${totalEmployees}">0</h3>
                        </div>
                        <i class="bi bi-people fs-1 opacity-50"></i>
                    </div>
                    <p class="card-text mb-0">Всего активных</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-graph-up"></i> Статус расчетов
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Сотрудники с расчетами</span>
                            <span th:text="${employeesWithCalculations + '/' + totalEmployees}"></span>
                        </div>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar bg-success"
                                 th:styleappend="'width: ' + ${(employeesWithCalculations / totalEmployees) * 100} + '%;'"
                                 role="progressbar">
                                <span th:text="${#numbers.formatDecimal((employeesWithCalculations / totalEmployees) * 100, 1, 1) + '%'}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-lightning"></i> Быстрые действия
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a th:href="@{/accountant/deductions(month=${month}, year=${year})}"
                           class="btn btn-outline-primary btn-lg">
                            <i class="bi bi-calculator"></i> Управление удержаниями
                        </a>
                        <a th:href="@{/accountant/reports(month=${month}, year=${year})}"
                           class="btn btn-outline-info">
                            <i class="bi bi-file-text"></i> Сформировать отчеты
                        </a>
                        <a th:href="@{/accountant/payments(month=${month}, year=${year})}"
                           class="btn btn-outline-secondary">
                            <i class="bi bi-cash-stack"></i> Просмотреть все платежи
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="scripts">
    <script>
        function changePeriod() {
            const select = document.getElementById('periodSelect');
            const [month, year] = select.value.split(',');
            window.location.href = '/accountant/dashboard?month=' + month + '&year=' + year;
        }
    </script>
</div>
</body>
</html>